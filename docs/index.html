<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Flipkart Casino Spin & Win</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #2874f0;
  margin: 0;
  padding: 0;
  text-align: center;
  color: #fff;
}
header {
  padding: 12px;
  background: #0d47a1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}
header img { height: 34px; }
main { padding: 20px; }
.machine {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin: 40px auto;
  perspective: 1000px;
}
.reel {
  width: 100px;
  height: 120px;
  border: 4px solid gold;
  border-radius: 12px;
  overflow: hidden;
  background: #000;
  box-shadow: inset 0 0 12px #000, 0 0 20px gold;
}
.icons { position: relative; top: 0; }
.icons img {
  display: none; /* hide initially, loopReel will show */
  width: 100%;
  height: 120px;
  object-fit: contain;
  background: #000;
}
#spinBtn {
  background: #ffeb3b;
  color: #2874f0;
  padding: 14px 28px;
  border-radius: 10px;
  border: 0;
  font-weight: 800;
  cursor: pointer;
  font-size: 1.1rem;
  margin-top: 16px;
}
#result { margin-top: 18px; font-size: 1.2rem; min-height: 28px; }
#instructions { margin-top: 10px; }
#shareBlock { display: none; margin-top: 16px; }
.share-btn { background: #25D366; color: #fff; padding: 10px 16px; border-radius: 8px; border: 0; cursor: pointer; margin: 6px; }
#confirmShare { background: #1976d2; }
#userForm { display: none; margin-top: 14px; max-width: 320px; margin-left:auto; margin-right:auto; text-align:left; }
#userForm input { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:1px solid #ccc; }
footer { padding: 14px; font-size: 0.85rem; color: #fff; }
canvas#confetti-canvas { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:999; }
.countdown { font-size: 1.3rem; margin-top: 12px; }
</style>
</head>
<body>
<header>
  <img src="flipkart.png" alt="Flipkart Logo" /> Big Billion Days – Casino Spin & Win
</header>

<main>
<p>You have <strong>3 spins</strong>.</p>

<div class="machine">
  <div class="reel" id="reel1">
    <div class="icons">
      <img src="ipad.png" alt="iPad" />
      <img src="ps5.png" alt="PS5" />
      <img src="watch.png" alt="Watch" />
      <img src="iphone.png" alt="iPhone" />
    </div>
  </div>
  <div class="reel" id="reel2">
    <div class="icons">
      <img src="ipad.png" alt="iPad" />
      <img src="ps5.png" alt="PS5" />
      <img src="watch.png" alt="Watch" />
      <img src="iphone.png" alt="iPhone" />
    </div>
  </div>
  <div class="reel" id="reel3">
    <div class="icons">
      <img src="ipad.png" alt="iPad" />
      <img src="ps5.png" alt="PS5" />
      <img src="watch.png" alt="Watch" />
      <img src="iphone.png" alt="iPhone" />
    </div>
  </div>
</div>

<button id="spinBtn">SPIN</button>
<div id="result"></div>
<div id="instructions"></div>
<div class="countdown" id="countdown"></div>

<div id="shareBlock">
  <p><strong>To claim, please share to 5 friends:</strong></p>
  <button id="shareNow" class="share-btn">Share via WhatsApp</button>
  <button id="confirmShare" class="share-btn">Confirm Share</button>
  <div id="shareMsg"></div>
</div>

<form id="userForm">
  <label for="name">Name</label>
  <input id="name" type="text" placeholder="Your name" required />
  <label for="mobile">Mobile</label>
  <input id="mobile" type="tel" placeholder="Mobile number" required />
  <button id="submitBtn" type="submit" class="share-btn" style="width:100%;background:#ffeb3b;color:#2874f0;margin-top:6px">Submit</button>
</form>
</main>

<footer>© Spin & Win Project</footer>
<canvas id="confetti-canvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const reels = document.querySelectorAll('.icons');
  const spinBtn = document.getElementById('spinBtn');
  const result = document.getElementById('result');
  const instructions = document.getElementById('instructions');
  const shareBlock = document.getElementById('shareBlock');
  const shareNow = document.getElementById('shareNow');
  const confirmShare = document.getElementById('confirmShare');
  const shareMsg = document.getElementById('shareMsg');
  const userForm = document.getElementById('userForm');

  let state = { spins: 0, shareConfirmAttempts: 0 };

  // Loop reel images continuously for duration seconds
  function loopReel(reel, duration=5) {
    const imgs = Array.from(reel.children);
    let idx = 0;
    const intervalTime = 100; // change image every 0.1s
    return new Promise(resolve => {
      const interval = setInterval(() => {
        imgs.forEach(img => img.style.display = 'none');
        imgs[idx % imgs.length].style.display = 'block';
        idx++;
      }, intervalTime);

      setTimeout(() => {
        clearInterval(interval);
        resolve();
      }, duration * 1000);
    });
  }

  function stopReelAt(reel, stopIndex) {
    const imgs = Array.from(reel.children);
    imgs.forEach((img, i) => img.style.display = (i === stopIndex) ? 'block' : 'none');
  }

  function fireConfetti(duration=3000) {
    const end = Date.now() + duration;
    (function frame(){
      confetti({ particleCount:6, spread:70, origin:{y:0.6} });
      if(Date.now() < end) requestAnimationFrame(frame);
    })();
  }

  function refreshUI() {
    if(state.spins < 3){
      result.textContent = '❌ Oops! You did not win this spin, try again.';
      instructions.textContent = 'Wait 10 seconds to spin again.';
    } else {
      result.textContent = '🎉 You won an iPhone! 🎁';
      instructions.textContent = '';
      shareBlock.style.display = 'block';
      reels.forEach(r => Array.from(r.children).forEach(c => c.src='iphone.png'));
      fireConfetti(5000);
    }
  }

  spinBtn.addEventListener('click', async () => {
    state.spins++;
    spinBtn.disabled = true;
    result.textContent = '';
    instructions.textContent = '';

    // loop images for 5 seconds
    await Promise.all([
      loopReel(reels[0], 5),
      loopReel(reels[1], 5),
      loopReel(reels[2], 5)
    ]);

    // stop reels: first 2 spins blank, last spin iPhone
    const stopIndex = (state.spins < 3) ? -1 : 3;
    reels.forEach(r => stopIndex === -1 ? r.querySelectorAll('img').forEach(img => img.style.display='none') : stopReelAt(r, stopIndex));

    refreshUI();

    // go to hold page after 100ms
    setTimeout(() => window.location.href='hold.html', 100);
  });

  shareNow.addEventListener('click', () => {
    const text = encodeURIComponent('I just won on Flipkart Casino Spin & Win!');
    window.open(`https://api.whatsapp.com/send?text=${text}`, '_blank');
    shareMsg.textContent = 'Shared! Now click Confirm Share.';
  });

  confirmShare.addEventListener('click', () => {
    state.shareConfirmAttempts++;
    if(state.shareConfirmAttempts === 1){
      alert('❌ Sharing failed! Try again.');
      shareMsg.textContent = 'Click Share again.';
    } else {
      shareMsg.textContent = '✅ Share confirmed. Enter your details below.';
      userForm.style.display = 'block';
      shareBlock.querySelectorAll('button').forEach(b => b.style.display = 'none');
    }
  });

  userForm.addEventListener('submit', (e) => {
    e.preventDefault();
    alert('✅ Submission successful. We will contact you soon.');
    window.open('https://www.example.com/thankyou', '_blank');
  });
});
</script>
</body>
</html>
